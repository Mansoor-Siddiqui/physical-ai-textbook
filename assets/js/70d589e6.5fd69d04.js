"use strict";(globalThis.webpackChunkphysical_ai_textbook=globalThis.webpackChunkphysical_ai_textbook||[]).push([[283],{3846(e,n,r){r.r(n),r.d(n,{assets:()=>t,contentTitle:()=>l,default:()=>u,frontMatter:()=>s,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"labs/lab03-gazebo-sim","title":"Lab 3: Gazebo Simulation","description":"Simulate your robot in Gazebo with sensors and control","source":"@site/docs/labs/lab03-gazebo-sim.md","sourceDirName":"labs","slug":"/labs/lab03-gazebo-sim","permalink":"/physical-ai-textbook/docs/labs/lab03-gazebo-sim","draft":false,"unlisted":false,"editUrl":"https://github.com/Mansoor-Siddiqui/physical-ai-textbook/tree/master/physical-ai-textbook/docs/labs/lab03-gazebo-sim.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Lab 3: Gazebo Simulation","description":"Simulate your robot in Gazebo with sensors and control","keywords":["gazebo","simulation","physics","sensors","lab"]},"sidebar":"labsSidebar","previous":{"title":"Lab 2: URDF Robot Design","permalink":"/physical-ai-textbook/docs/labs/lab02-urdf-design"},"next":{"title":"Lab 4: Isaac Sim Basics","permalink":"/physical-ai-textbook/docs/labs/lab04-isaac-basics"}}');var i=r(4848),o=r(8453);const s={sidebar_position:3,title:"Lab 3: Gazebo Simulation",description:"Simulate your robot in Gazebo with sensors and control",keywords:["gazebo","simulation","physics","sensors","lab"]},l="Lab 3: Gazebo Simulation",t={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Objectives",id:"objectives",level:2},{value:"Step 1: Install Gazebo Dependencies",id:"step-1-install-gazebo-dependencies",level:2},{value:"Step 2: Add Gazebo Tags to URDF",id:"step-2-add-gazebo-tags-to-urdf",level:2},{value:"Step 3: Update Main URDF",id:"step-3-update-main-urdf",level:2},{value:"Step 4: Create World File",id:"step-4-create-world-file",level:2},{value:"Step 5: Create Gazebo Launch File",id:"step-5-create-gazebo-launch-file",level:2},{value:"Step 6: Update Package Files",id:"step-6-update-package-files",level:2},{value:"Step 7: Build and Launch",id:"step-7-build-and-launch",level:2},{value:"Step 8: Control the Robot",id:"step-8-control-the-robot",level:2},{value:"Step 9: Visualize in RViz",id:"step-9-visualize-in-rviz",level:2},{value:"Step 10: Record and Playback",id:"step-10-record-and-playback",level:2},{value:"Verification Checklist",id:"verification-checklist",level:2},{value:"Challenge",id:"challenge",level:2},{value:"Summary",id:"summary",level:2},{value:"Next Lab",id:"next-lab",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"lab-3-gazebo-simulation",children:"Lab 3: Gazebo Simulation"})}),"\n",(0,i.jsx)(n.p,{children:"In this lab, you'll simulate your robot in Gazebo, add sensors, and control it with ROS2."}),"\n",(0,i.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Completed Lab 2 (URDF robot)"}),"\n",(0,i.jsx)(n.li,{children:"Gazebo installed with ROS2 integration"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"objectives",children:"Objectives"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Launch robot in Gazebo"}),"\n",(0,i.jsx)(n.li,{children:"Add Gazebo plugins for sensors"}),"\n",(0,i.jsx)(n.li,{children:"Control robot with teleop"}),"\n",(0,i.jsx)(n.li,{children:"Visualize sensor data in RViz"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"step-1-install-gazebo-dependencies",children:"Step 1: Install Gazebo Dependencies"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo apt install ros-humble-ros-gz ros-humble-gazebo-ros-pkgs\n"})}),"\n",(0,i.jsx)(n.h2,{id:"step-2-add-gazebo-tags-to-urdf",children:"Step 2: Add Gazebo Tags to URDF"}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:"urdf/my_robot.gazebo.xacro"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0"?>\r\n<robot xmlns:xacro="http://www.ros.org/wiki/xacro">\r\n\r\n  \x3c!-- Gazebo Colors --\x3e\r\n  <gazebo reference="base_link">\r\n    <material>Gazebo/Blue</material>\r\n  </gazebo>\r\n  \r\n  <gazebo reference="left_wheel">\r\n    <material>Gazebo/Black</material>\r\n    <mu1>1.0</mu1>\r\n    <mu2>1.0</mu2>\r\n  </gazebo>\r\n  \r\n  <gazebo reference="right_wheel">\r\n    <material>Gazebo/Black</material>\r\n    <mu1>1.0</mu1>\r\n    <mu2>1.0</mu2>\r\n  </gazebo>\r\n  \r\n  <gazebo reference="caster_wheel">\r\n    <material>Gazebo/White</material>\r\n    <mu1>0.0</mu1>\r\n    <mu2>0.0</mu2>\r\n  </gazebo>\r\n\r\n  \x3c!-- Differential Drive Plugin --\x3e\r\n  <gazebo>\r\n    <plugin name="diff_drive" filename="libgazebo_ros_diff_drive.so">\r\n      <ros>\r\n        <namespace>/my_robot</namespace>\r\n      </ros>\r\n      \r\n      <left_joint>left_wheel_joint</left_joint>\r\n      <right_joint>right_wheel_joint</right_joint>\r\n      \r\n      <wheel_separation>0.24</wheel_separation>\r\n      <wheel_diameter>0.1</wheel_diameter>\r\n      \r\n      <max_wheel_torque>20</max_wheel_torque>\r\n      <max_wheel_acceleration>1.0</max_wheel_acceleration>\r\n      \r\n      <command_topic>cmd_vel</command_topic>\r\n      <odometry_topic>odom</odometry_topic>\r\n      <odometry_frame>odom</odometry_frame>\r\n      <robot_base_frame>base_footprint</robot_base_frame>\r\n      \r\n      <publish_odom>true</publish_odom>\r\n      <publish_odom_tf>true</publish_odom_tf>\r\n      <publish_wheel_tf>false</publish_wheel_tf>\r\n      \r\n      <update_rate>50</update_rate>\r\n    </plugin>\r\n  </gazebo>\r\n\r\n  \x3c!-- LiDAR Plugin --\x3e\r\n  <gazebo reference="lidar_link">\r\n    <material>Gazebo/Red</material>\r\n    <sensor name="lidar" type="ray">\r\n      <always_on>true</always_on>\r\n      <update_rate>10</update_rate>\r\n      <ray>\r\n        <scan>\r\n          <horizontal>\r\n            <samples>360</samples>\r\n            <resolution>1</resolution>\r\n            <min_angle>-3.14159</min_angle>\r\n            <max_angle>3.14159</max_angle>\r\n          </horizontal>\r\n        </scan>\r\n        <range>\r\n          <min>0.1</min>\r\n          <max>10.0</max>\r\n          <resolution>0.01</resolution>\r\n        </range>\r\n        <noise>\r\n          <type>gaussian</type>\r\n          <mean>0.0</mean>\r\n          <stddev>0.01</stddev>\r\n        </noise>\r\n      </ray>\r\n      <plugin name="lidar_controller" filename="libgazebo_ros_ray_sensor.so">\r\n        <ros>\r\n          <namespace>/my_robot</namespace>\r\n          <remapping>~/out:=scan</remapping>\r\n        </ros>\r\n        <output_type>sensor_msgs/LaserScan</output_type>\r\n        <frame_name>lidar_link</frame_name>\r\n      </plugin>\r\n    </sensor>\r\n  </gazebo>\r\n\r\n</robot>\n'})}),"\n",(0,i.jsx)(n.h2,{id:"step-3-update-main-urdf",children:"Step 3: Update Main URDF"}),"\n",(0,i.jsxs)(n.p,{children:["Update ",(0,i.jsx)(n.code,{children:"urdf/my_robot.urdf.xacro"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0"?>\r\n<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="my_robot">\r\n  \r\n  \x3c!-- Include Gazebo file --\x3e\r\n  <xacro:include filename="$(find my_robot_description)/urdf/my_robot.gazebo.xacro"/>\r\n  \r\n  \x3c!-- Rest of robot definition... --\x3e\r\n  \r\n</robot>\n'})}),"\n",(0,i.jsx)(n.h2,{id:"step-4-create-world-file",children:"Step 4: Create World File"}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:"worlds/simple_world.world"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0"?>\r\n<sdf version="1.6">\r\n  <world name="simple_world">\r\n    \r\n    \x3c!-- Sun --\x3e\r\n    <include>\r\n      <uri>model://sun</uri>\r\n    </include>\r\n    \r\n    \x3c!-- Ground Plane --\x3e\r\n    <include>\r\n      <uri>model://ground_plane</uri>\r\n    </include>\r\n    \r\n    \x3c!-- Walls --\x3e\r\n    <model name="wall_1">\r\n      <static>true</static>\r\n      <pose>5 0 0.5 0 0 0</pose>\r\n      <link name="link">\r\n        <collision name="collision">\r\n          <geometry>\r\n            <box><size>0.1 10 1</size></box>\r\n          </geometry>\r\n        </collision>\r\n        <visual name="visual">\r\n          <geometry>\r\n            <box><size>0.1 10 1</size></box>\r\n          </geometry>\r\n        </visual>\r\n      </link>\r\n    </model>\r\n    \r\n    \x3c!-- Obstacles --\x3e\r\n    <model name="obstacle_1">\r\n      <static>true</static>\r\n      <pose>2 1 0.25 0 0 0</pose>\r\n      <link name="link">\r\n        <collision name="collision">\r\n          <geometry>\r\n            <cylinder><radius>0.3</radius><length>0.5</length></cylinder>\r\n          </geometry>\r\n        </collision>\r\n        <visual name="visual">\r\n          <geometry>\r\n            <cylinder><radius>0.3</radius><length>0.5</length></cylinder>\r\n          </geometry>\r\n          <material>\r\n            <ambient>0.8 0.2 0.2 1</ambient>\r\n          </material>\r\n        </visual>\r\n      </link>\r\n    </model>\r\n\r\n  </world>\r\n</sdf>\n'})}),"\n",(0,i.jsx)(n.h2,{id:"step-5-create-gazebo-launch-file",children:"Step 5: Create Gazebo Launch File"}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:"launch/gazebo.launch.py"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import os\r\nfrom launch import LaunchDescription\r\nfrom launch.actions import DeclareLaunchArgument, IncludeLaunchDescription\r\nfrom launch.launch_description_sources import PythonLaunchDescriptionSource\r\nfrom launch.substitutions import Command, LaunchConfiguration, PathJoinSubstitution\r\nfrom launch_ros.actions import Node\r\nfrom launch_ros.substitutions import FindPackageShare\r\nfrom ament_index_python.packages import get_package_share_directory\r\n\r\n\r\ndef generate_launch_description():\r\n    pkg_share = FindPackageShare('my_robot_description')\r\n    pkg_gazebo_ros = get_package_share_directory('gazebo_ros')\r\n    \r\n    # Paths\r\n    urdf_file = PathJoinSubstitution([\r\n        pkg_share, 'urdf', 'my_robot.urdf.xacro'\r\n    ])\r\n    world_file = PathJoinSubstitution([\r\n        pkg_share, 'worlds', 'simple_world.world'\r\n    ])\r\n    \r\n    # Robot description\r\n    robot_description = Command(['xacro ', urdf_file])\r\n    \r\n    # Declare arguments\r\n    use_sim_time = LaunchConfiguration('use_sim_time', default='true')\r\n    \r\n    return LaunchDescription([\r\n        # Declare launch arguments\r\n        DeclareLaunchArgument(\r\n            'use_sim_time',\r\n            default_value='true',\r\n            description='Use simulation time'\r\n        ),\r\n        \r\n        # Gazebo Server\r\n        IncludeLaunchDescription(\r\n            PythonLaunchDescriptionSource(\r\n                os.path.join(pkg_gazebo_ros, 'launch', 'gzserver.launch.py')\r\n            ),\r\n            launch_arguments={'world': world_file}.items()\r\n        ),\r\n        \r\n        # Gazebo Client\r\n        IncludeLaunchDescription(\r\n            PythonLaunchDescriptionSource(\r\n                os.path.join(pkg_gazebo_ros, 'launch', 'gzclient.launch.py')\r\n            )\r\n        ),\r\n        \r\n        # Robot State Publisher\r\n        Node(\r\n            package='robot_state_publisher',\r\n            executable='robot_state_publisher',\r\n            name='robot_state_publisher',\r\n            parameters=[{\r\n                'robot_description': robot_description,\r\n                'use_sim_time': use_sim_time\r\n            }],\r\n            output='screen'\r\n        ),\r\n        \r\n        # Spawn Robot\r\n        Node(\r\n            package='gazebo_ros',\r\n            executable='spawn_entity.py',\r\n            name='spawn_entity',\r\n            arguments=[\r\n                '-topic', 'robot_description',\r\n                '-entity', 'my_robot',\r\n                '-x', '0',\r\n                '-y', '0',\r\n                '-z', '0.1'\r\n            ],\r\n            output='screen'\r\n        ),\r\n    ])\n"})}),"\n",(0,i.jsx)(n.h2,{id:"step-6-update-package-files",children:"Step 6: Update Package Files"}),"\n",(0,i.jsxs)(n.p,{children:["Update ",(0,i.jsx)(n.code,{children:"setup.py"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"data_files=[\r\n    # ... existing entries ...\r\n    (os.path.join('share', package_name, 'worlds'), \r\n        glob('worlds/*.world')),\r\n],\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Update ",(0,i.jsx)(n.code,{children:"package.xml"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:"<exec_depend>gazebo_ros</exec_depend>\r\n<exec_depend>gazebo_plugins</exec_depend>\n"})}),"\n",(0,i.jsx)(n.h2,{id:"step-7-build-and-launch",children:"Step 7: Build and Launch"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws\r\ncolcon build --packages-select my_robot_description\r\nsource install/setup.bash\r\n\r\nros2 launch my_robot_description gazebo.launch.py\n"})}),"\n",(0,i.jsx)(n.h2,{id:"step-8-control-the-robot",children:"Step 8: Control the Robot"}),"\n",(0,i.jsx)(n.p,{children:"In a new terminal:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Install teleop\r\nsudo apt install ros-humble-teleop-twist-keyboard\r\n\r\n# Run teleop\r\nros2 run teleop_twist_keyboard teleop_twist_keyboard \\\r\n    --ros-args --remap cmd_vel:=/my_robot/cmd_vel\n"})}),"\n",(0,i.jsx)(n.p,{children:"Use keyboard:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"i"}),": Forward"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:","}),": Backward"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"j"}),": Turn left"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"l"}),": Turn right"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"k"}),": Stop"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"step-9-visualize-in-rviz",children:"Step 9: Visualize in RViz"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ros2 run rviz2 rviz2\n"})}),"\n",(0,i.jsx)(n.p,{children:"Add displays:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"RobotModel"})," - Topic: ",(0,i.jsx)(n.code,{children:"/robot_description"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"LaserScan"})," - Topic: ",(0,i.jsx)(n.code,{children:"/my_robot/scan"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Odometry"})," - Topic: ",(0,i.jsx)(n.code,{children:"/my_robot/odom"})]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"step-10-record-and-playback",children:"Step 10: Record and Playback"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Record topics\r\nros2 bag record -o my_robot_bag /my_robot/scan /my_robot/odom /my_robot/cmd_vel\r\n\r\n# Playback\r\nros2 bag play my_robot_bag\n"})}),"\n",(0,i.jsx)(n.h2,{id:"verification-checklist",children:"Verification Checklist"}),"\n",(0,i.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Robot spawns in Gazebo"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Robot moves with teleop"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","LiDAR scan visible in RViz"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Odometry updates as robot moves"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"challenge",children:"Challenge"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Add a camera sensor with image topic"}),"\n",(0,i.jsx)(n.li,{children:"Create a maze world for navigation"}),"\n",(0,i.jsx)(n.li,{children:"Implement obstacle avoidance using LiDAR"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(n.p,{children:"You learned how to:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Add Gazebo plugins to URDF"}),"\n",(0,i.jsx)(n.li,{children:"Launch robot in Gazebo simulation"}),"\n",(0,i.jsx)(n.li,{children:"Control robot with teleop"}),"\n",(0,i.jsx)(n.li,{children:"Visualize sensor data"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"next-lab",children:"Next Lab"}),"\n",(0,i.jsxs)(n.p,{children:["Continue to ",(0,i.jsx)(n.a,{href:"/docs/labs/lab04-isaac-basics",children:"Lab 4: Isaac Sim Basics"})," to explore NVIDIA's advanced simulator."]})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,n,r){r.d(n,{R:()=>s,x:()=>l});var a=r(6540);const i={},o=a.createContext(i);function s(e){const n=a.useContext(o);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),a.createElement(o.Provider,{value:n},e.children)}}}]);